{
  "hash": "f3e56e19a969b4b16e5c0f38fdd08469",
  "result": {
    "markdown": "---\ntitle: \"Draft Quarto document\"\nauthor:\n  - name: Kaja Madsen\n    affiliations:\n      - name: University of Southern Denmark\nformat: html\neditor:\n  markdown: \n    wrap: 72\n    canonical: TRUE\n---\n\n::: {.cell}\n\n```{.r .cell-code}\ntargets::tar_config_set(store = here::here(\"_targets\"))\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'tidyverse' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'tibble' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'tidyr' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'readr' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'stringr' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'forcats' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.3     v readr     2.1.4\nv forcats   1.0.0     v stringr   1.5.0\nv ggplot2   3.4.4     v tibble    3.2.1\nv lubridate 1.9.3     v tidyr     1.3.0\nv purrr     1.0.2     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching packages -------------------------------------- tidymodels 1.1.1 --\nv broom        1.0.5     v rsample      1.2.0\nv dials        1.2.0     v tune         1.1.2\nv infer        1.0.5     v workflows    1.1.3\nv modeldata    1.2.0     v workflowsets 1.0.1\nv parsnip      1.1.1     v yardstick    1.2.0\nv recipes      1.0.8     \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'dials' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'scales' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'workflows' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: pakke 'workflowsets' blev bygget under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Conflicts ----------------------------------------- tidymodels_conflicts() --\nx scales::discard() masks purrr::discard()\nx dplyr::filter()   masks stats::filter()\nx recipes::fixed()  masks stringr::fixed()\nx dplyr::lag()      masks stats::lag()\nx yardstick::spec() masks readr::spec()\nx recipes::step()   masks stats::step()\n* Learn how to get started at https://www.tidymodels.org/start/\n```\n:::\n\n```{.r .cell-code}\nsource(here::here(\"R/functions.R\"))\nlipidomics <- tar_read(lipidomics)\n```\n:::\n\n\n## Results\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_read(df_stats_by_metabolite) %>%\n  mutate(MeanSD = glue::glue(\"{value_mean} ({value_sd})\")) %>%\n  select(Metabolites = metabolite, `Mean SD` = MeanSD) %>%\n  knitr::kable(caption = \"Desciptive statistics of the metabolites\")\n```\n\n::: {.cell-output-display}\nTable: Desciptive statistics of the metabolites\n\n|Metabolites              |Mean SD      |\n|:------------------------|:------------|\n|CDCl3 (solvent)          |180 (67)     |\n|Cholesterol              |18.6 (11.4)  |\n|FA -CH2CH2COO-           |33.6 (7.8)   |\n|Lipid -CH2-              |536.6 (61.9) |\n|Lipid CH3- 1             |98.3 (73.8)  |\n|Lipid CH3- 2             |168.2 (29.2) |\n|MUFA+PUFA                |32.9 (16.1)  |\n|PUFA                     |30 (24.1)    |\n|Phosphatidycholine       |31.7 (20.5)  |\n|Phosphatidylethanolamine |10 (7.6)     |\n|Phospholipids            |2.7 (2.6)    |\n|TMS (interntal standard) |123 (130.4)  |\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_read(fig_metabolite_distribution)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](learning_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Running multiple models\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_estimates <- lipidomics %>%\n  split_by_metabolite() %>%\n  map(generate_model_results) %>%\n  list_rbind() %>%\n  filter(str_detect(term, \"metabolite_\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: algorithm did not converge\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n```\n:::\n\n```{.r .cell-code}\nmodel_estimates\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 x 5\n   term                                 estimate  std.error statistic p.value\n   <chr>                                   <dbl>      <dbl>     <dbl>   <dbl>\n 1 metabolite_cd_cl_3_solvent          8.70e-  2      0.865 -2.82     0.00475\n 2 metabolite_cholesterol              2.97e+  0      0.458  2.38     0.0175 \n 3 metabolite_fa_ch_2_ch_2_coo         1.52e+  0      0.387  1.09     0.276  \n 4 metabolite_lipid_ch_2               2.59e-  3      3.14  -1.90     0.0578 \n 5 metabolite_lipid_ch_3_1             4.45e+  1      1.41   2.70     0.00697\n 6 metabolite_lipid_ch_3_2             8.85e-  1      0.361 -0.339    0.734  \n 7 metabolite_mufa_pufa                4.56e-  1      0.449 -1.75     0.0798 \n 8 metabolite_phosphatidycholine       1.28e-120 116628.    -0.00237  0.998  \n 9 metabolite_phosphatidylethanolamine 2.69e+  1      1.32   2.49     0.0129 \n10 metabolite_phospholipids            2.39e- 19  68964.    -0.000622 1.00   \n11 metabolite_pufa                     3.27e+  0      0.560  2.11     0.0345 \n12 metabolite_tms_interntal_standard   5.62e-  2      0.990 -2.91     0.00363\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#' Add the original metabolite names (not as snakecase) to the model results\n#'\n#' @param model_results The data frame with the model results\n#' @param data The original, unprocessed lipidomics dataset\n#'\n#' @return A data frame\n\nadd_original_metabolite_names <- function(model_results, data) {\n  data %>%\n    dplyr::mutate(term = metabolite) %>%\n    column_values_to_snake_case(term) %>%\n    dplyr::mutate(term = stringr::str_c(\"metabolite_\", term)) %>%\n    dplyr::distinct(term, metabolite) %>%\n    dplyr::right_join(model_results, by = \"term\")\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncalculate_estimates(lipidomics)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: algorithm did not converge\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 x 6\n   term                         metabolite  estimate std.error statistic p.value\n   <chr>                        <chr>          <dbl>     <dbl>     <dbl>   <dbl>\n 1 metabolite_tms_interntal_st~ TMS (inte~ 5.62e-  2   9.90e-1 -2.91     0.00363\n 2 metabolite_cholesterol       Cholester~ 2.97e+  0   4.58e-1  2.38     0.0175 \n 3 metabolite_lipid_ch_3_1      Lipid CH3~ 4.45e+  1   1.41e+0  2.70     0.00697\n 4 metabolite_lipid_ch_3_2      Lipid CH3~ 8.85e-  1   3.61e-1 -0.339    0.734  \n 5 metabolite_lipid_ch_2        Lipid -CH~ 2.59e-  3   3.14e+0 -1.90     0.0578 \n 6 metabolite_fa_ch_2_ch_2_coo  FA -CH2CH~ 1.52e+  0   3.87e-1  1.09     0.276  \n 7 metabolite_pufa              PUFA       3.27e+  0   5.60e-1  2.11     0.0345 \n 8 metabolite_phosphatidyletha~ Phosphati~ 2.69e+  1   1.32e+0  2.49     0.0129 \n 9 metabolite_phosphatidycholi~ Phosphati~ 1.28e-120   1.17e+5 -0.00237  0.998  \n10 metabolite_phospholipids     Phospholi~ 2.39e- 19   6.90e+4 -0.000622 1.00   \n11 metabolite_mufa_pufa         MUFA+PUFA  4.56e-  1   4.49e-1 -1.75     0.0798 \n12 metabolite_cd_cl_3_solvent   CDCl3 (so~ 8.70e-  2   8.65e-1 -2.82     0.00475\n```\n:::\n:::\n\n\n### Figure of model estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_estimates <- tar_read(df_model_estimates)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_read(fig_model_estimates)\n```\n\n::: {.cell-output-display}\n![](learning_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "learning_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}